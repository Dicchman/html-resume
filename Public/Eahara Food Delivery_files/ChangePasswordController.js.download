angular.module("eahara")
    .controller("ChangePasswordController", ["app.config", "$scope", "LoginService", "AuthenticationService", "$state", "$stateParams", "MainService", "localStorageService",
            function (config, $scope, LoginService, AuthenticationService, $state, $stateParams, MainService, localStorageService) {

                $scope.init = function () {

                    $scope.User = {
                        Id: 0,
                        UserName: "",
                        Password: "",
                        CPassword: "",
                        Roles: "",
                    }
                    $scope.IsEdit = false;

                    $scope.IsErrorPass = false;
                    $scope.IsErrorCpass = false;

                    $scope.TokenInfo = AuthenticationService.getTokenInfo();
                    if ($scope.TokenInfo != null) {
                        $scope.User.UserName = $scope.TokenInfo.UserName;
                        $scope.IsLoggedIn = true;
                    }

                    $scope.settings = {};
                    MainService.GetCompanyProfile().then(function (res) {
                        $scope.settings = res.data;
                    })

                }

                $scope.init();


                $scope.changePassword = function () {

                    $scope.User.Id = $scope.TokenInfo.Id;

                    if ($scope.User.Password == "" || $scope.User.Password == undefined) {
                        $scope.IsErrorPass = true;
                    }
                    else if ($scope.User.Password != $scope.User.CPassword) {
                        $scope.IsErrorCpass = true;
                        $scope.IsErrorPass = false;

                    }
                    else {
                        $scope.IsErrorCpass = false;
                        $scope.IsErrorPass = false;
                        MainService.ChangePassword($scope.User).then(function (response) {
                            if (response.data) {
                                toastr.success("Successfully Changed Password");
                                $scope.reset();
                            }
                        }, function (err) {
                            toastr.error("Network Error");
                        });
                    }
                };

            }]);
